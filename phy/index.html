<!DOCTYPE html>
<html>
    
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
	    <title>Simple Physics Game</title>
	
        <style>
        *{padding: 0;border: 0;margin: 0;}
			html{background-color: #7171F1;}
            body{background-color: #333;font-family: monospace;height: 98vh !important;width: 98vw;
				margin-left:1vw;margin-right: 1vw;margin-top: 1vh;margin-bottom: 1vh;}
        	#container{height: 100%;width:100%;position: relative;background-color: #544;}
        #box{    
			height: 40px;
			width: 40px;
			top: 45vh;
			left: 45vw;
			box-sizing: border-box;
			padding: 10px;
			position: fixed;
			z-index: 10;
			background-color: #fff;
			transition: 0.2s linear;
			box-shadow: 0 0 2px 2px #999;
			text-align:center;
			border-radius: 50%;
		}
		#inst{
			display: block;
			padding: 2vw;
			margin: auto;
			width: 70vw;
			color: #d0c8ba9c;
			user-select:none;
		}
        </style>
    </head>
    <body>
	<div id="box">||</div>
    <div id="conntainer">
		<div id="inst">
			Simple Physics Game<br>
			---------------
			<ul> 
				<li> W A S D to change velocity </li>
				<li> Up arrow to Start </li>
				<li> Down arrow to Reset velocity </li>
				<li> Space to Pause </li>
				<li>Velocity Meter [ <span id="v_meter"></span> ] </li>
			</ul>
		</div>
		
	
        
    </div>
        <script>
		function _width(){return window.innerWidth - 40; }
		function _height(){return window.innerHeight - 40;}

		var currentHeight= _height();
        var currentWidth= _width();
        var velocity=[0 , 0];// px/step
		const step = 2;
		const bx = document.getElementById("box");
		var box_len = bx.getAttribute('left');
		const v_meter = document.getElementById("v_meter");
		const W_KEY = 87;
		const S_KEY = 83;
		const A_KEY = 65;
		const D_KEY = 68;
		const UP_KEY = 38;
		const DOWN_KEY = 40;
		const SPACE_KEY = 32;
		const v_lim = 40;
		var time_handle = null;
		const time_gap = 50; // ms
		
		function updateLeft(left){	bx.style.left = left + 'px';}
		
		function updateTop(top){	bx.style.top = top + 'px';	}

		function pause(){
			if(time_handle != null){
				clearInterval(time_handle);
				time_handle = null;
			}
		}

		function move(){
			var boxLeft = bx.offsetLeft;
			var boxTop = bx.offsetTop;
			if((velocity[0] < 0 && boxLeft + velocity[0] >= 0) || (velocity[0] > 0 && ((boxLeft + velocity[0] + box_len) < currentWidth))){ // safe horizontally
				updateLeft(velocity[0] + boxLeft);	
			}else{
				velocity[0] = -velocity[0];
				update_velocity();
			}

			if((velocity[1] < 0 && boxTop + velocity[1] >= 0) || (velocity[1] > 0 && ((boxTop + velocity[1] + box_len) <  currentHeight))){
				updateTop(velocity[1] + boxTop);
			}else{
				velocity[1] = -velocity[1];
				update_velocity();
			}
			
		}

		window.onresize = function(){
			
			currentHeight=_height();

			currentWidth= _width();
		}
		
		
		document.onclick = function(event){
			bx.style.left = Math.max(0,Math.min( event.clientX - box_len , currentWidth - box_len )) +'px';
			bx.style.top = Math.max(0,Math.min( event.clientY - box_len  , currentHeight - box_len )) +'px';
		}
		
		function update_velocity(){
			v_meter.innerHTML = 'x : '+(velocity[0]).toString() + ' y : '+(-1*velocity[1]).toString();
		}
		
        document.onkeydown = function(e){
					
			var pressed = parseInt(e.keyCode);
			
			// console.log(pressed);
			
			
			if(pressed === D_KEY){ // d going right
				if( velocity[0] + step < v_lim){
					velocity[0] += step;
					update_velocity();
				} 
			}
			if(pressed === A_KEY){ // a going left
				if( velocity[0] -step > -v_lim){
					velocity[0] -= step;
					update_velocity();
				}
			}
			if(pressed === S_KEY){ // s going down
				if( velocity[1] + step < v_lim){
					velocity[1] += step;
					update_velocity();
				}
			}
			if(pressed === W_KEY){ // w going up
				if( velocity[1] - step > -v_lim){
					velocity[1] -= step;
					update_velocity();
				}
			}

			
			if(pressed === SPACE_KEY){ // space
				if(time_handle !=null){
					clearInterval(time_handle);
					time_handle = null;
					bx.innerHTML = "||";
				}else{
					bx.innerHTML = "|>";
					time_handle = setInterval(move,time_gap);
				}
			}
			if(pressed === DOWN_KEY){
				velocity[0] = 0 , velocity[1]=0;
				update_velocity();
			}
			
			// if(pressed === 109){ // minus
			// 	if(box_len > 5){
			// 		box_len -= step;
			// 		bx.style.height = box_len + 'px';
			// 		bx.style.width = box_len + 'px';
			// 		updateLeft(Math.min(bx.offsetLeft,currentWidth-box_len));
			// 		updateTop(Math.min(bx.offsetTop,currentHeight-box_len));
			// 	}
			// }
			// if(pressed === 107){ // plus
			// 	if(box_len < Math.min(currentHeight,currentWidth)){
			// 		box_len += step;
			// 		bx.style.height = box_len + 'px';
			// 		bx.style.width = box_len + 'px';
			// 		updateLeft(Math.min(bx.offsetLeft,currentWidth-box_len));
			// 		updateTop(Math.min(bx.offsetTop,currentHeight-box_len));
			// 	}
			// }
			
			}
        </script>
    </body>
</html>
